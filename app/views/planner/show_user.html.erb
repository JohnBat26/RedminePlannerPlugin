<%= render :partial => "jqplot" %>

<h2><%= l(:label_planner_planning) %>: <%= @user.name %></h2>

<div class="jqPlot" id="chartUser" style="margin-top:20px; margin-left:20px; width:500px; height:300px;"></div>

<script type="text/javascript">
jQuery(document).ready(function() {
  var s1 = [20, 30, 20, 10, 30, 50, 30, 20];
  var s2 = [70, 50, 30, 20, 40, 30, 50, 30];
  var s3 = [10, 20, 30, 80, 10, 10, 20, 30];
  var ticks = ['2012-40', '2012-41', '2012-42', '2012-43', '2012-44', '2012-45', '2012-46', '2012-47'];
  var series = [
    {label: 'Task 1'},
    {label: 'Task 2'},
    {label: 'Task 3'}
  ];

  plotUser = jQuery.jqplot('chartUser', [s1, s2, s3], {
    animate: !jQuery.jqplot.use_excanvas,
    stackSeries: true,
    showMarker: false,
    seriesDefaults:{
      renderer:jQuery.jqplot.BarRenderer,
      pointLabels: {show: true},
      rendererOptions: {
        animation: {
          speed: 1000
        }
      }
    },
    series: series,
    axes: {
      xaxis: {
        renderer: jQuery.jqplot.CategoryAxisRenderer,
        ticks: ticks,
        label: 'Weeks'
      },
      yaxis: {
        labelRenderer: jQuery.jqplot.CanvasAxisLabelRenderer,
        min: 0,
        max: 120,
        label: 'Workload',
        tickInterval: 20,
        tickOptions: {
          suffix: '%'
        },
        padMin: 0
      }
    },
    legend: {
      show: true,
      location: 'e',
      placement: 'outside'
    },
  });

  // this should be library code
  jQuery('#chartUser').bind('jqplotDataHighlight', function(ev, seriesIndex, pointIndex, data) {
    var idx = -(seriesIndex + 1);
    jQuery('tr.jqplot-table-legend').removeClass('legend-row-highlighted');
    jQuery('tr.jqplot-table-legend').children('.jqplot-table-legend-label').removeClass('legend-text-highlighted');
    jQuery('tr.jqplot-table-legend').eq(idx).addClass('legend-row-highlighted');
    jQuery('tr.jqplot-table-legend').eq(idx).children('.jqplot-table-legend-label').addClass('legend-text-highlighted');
  });

  jQuery('#chartUser').bind('jqplotDataUnhighlight', function(ev, seriesIndex, pointIndex, data) {
    jQuery('tr.jqplot-table-legend').removeClass('legend-row-highlighted');
    jQuery('tr.jqplot-table-legend').children('.jqplot-table-legend-label').removeClass('legend-text-highlighted');
  });
});
</script>
